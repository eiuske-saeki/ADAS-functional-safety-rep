# ADAS ASIL Simulation Tool Architecture

## 1. データ生成モジュール (data_generator.py)
- 入力: ユーザー設定（車両パラメータ、シナリオ設定）
- 出力: シミュレーションデータ（CSV形式）
- 主要機能:
  - パラメータの範囲設定
  - データポイントの生成
  - 無効なデータポイントのフィルタリング
- 実装詳細:
  - 既存の datamake.py をリファクタリングして利用
  - パラメータのバリデーション機能の追加
  - 生成データの品質チェック機能の実装

## 2. シミュレーションエンジン (simulation_engine.py)
- 入力: 生成されたシミュレーションデータ（1レコードずつ）
- 出力: シミュレーション結果（衝突情報、S値、C値）
- 主要機能:
  - 車両運動モデル
  - 衝突検出アルゴリズム
  - 回避行動シミュレーション
- 実装詳細:
  - 物理エンジンの実装（車両の加速度、速度、位置の計算）
  - 衝突判定アルゴリズムの実装
  - 回避行動（減速、操舵）のモデリング
  - 各シナリオ（意図しない加速、減速、操舵）に対応するロジックの実装

## 3. ASIL計算モジュール (asil_calculator.py)
- 入力: シミュレーション結果、E値
- 出力: ASIL値
- 主要機能:
  - S値の計算
  - C値の計算
  - E値の適用
  - ASIL決定ロジック
- 実装詳細:
  - S値計算アルゴリズム（衝突速度に基づく）
  - C値計算アルゴリズム（回避行動の効果に基づく）
  - E値の適用ロジック
  - ASIL決定マトリックスの実装

## 4. 結果可視化モジュール (result_visualizer.py)
- 入力: 全シミュレーション結果とASIL値
- 出力: グラフィカルレポート（2Dマップなど）
- 主要機能:
  - データの集約と統計処理
  - グラフ生成（matplotlib等を使用）
  - レポート生成
- 実装詳細:
  - データ集約アルゴリズムの実装
  - 2Dマップ生成機能（初期車速 vs 最大加速度）
  - その他の統計グラフ（ヒストグラム、散布図など）の実装
  - PDF形式のレポート生成機能

## 5. GUIインターフェース (gui.py)
- 主要機能:
  - ユーザー入力受付
  - シミュレーション進捗表示
  - 結果表示
  - 設定保存/読み込み
- 実装詳細:
  - PyQt5を使用したGUIの設計と実装
  - 入力フォームの作成（車両パラメータ、シナリオ設定）
  - プログレスバーの実装
  - 結果表示画面の設計（グラフ、表の表示）
  - 設定のJSON形式での保存/読み込み機能

## 6. ユーティリティモジュール (utils.py)
- 共通関数（単位変換、物理計算など）
- ファイル入出力処理
- ログ機能
- 実装詳細:
  - 単位変換関数（km/h ⇔ m/s, G ⇔ m/s^2 など）
  - CSV, JSON ファイルの読み書き関数
  - ログ記録機能（logging モジュールの使用）

## 7. メインアプリケーション (main.py)
- 各モジュールの統合
- 全体の制御フロー管理
- 実装詳細:
  - モジュール間の連携ロジック
  - エラーハンドリング
  - マルチスレッド/マルチプロセス処理（パフォーマンス最適化）

## 開発環境とライブラリ
- 言語: Python 3.x
- GUI: PyQt5
- データ処理: Pandas, NumPy
- グラフ描画: Matplotlib
- 単体テスト: pytest

## 開発ステップ
1. データ生成モジュールのリファクタリングと拡張
2. シミュレーションエンジンの実装
3. ASIL計算モジュールの実装
4. 結果可視化モジュールの実装
5. GUIインターフェースの設計と実装
6. ユーティリティモジュールの実装
7. メインアプリケーションの統合
8. ユニットテストの作成と実行
9. 統合テストと性能最適化
10. ドキュメント作成とユーザーマニュアルの準備
